!function(c,i){"function"==typeof define&&define.amd?define(["exports"],i):i("object"==typeof exports?exports:c.rison={})}(this,function(c){var e,i=c;typeof i>"u"&&(window.rison={}),i.uri_ok={"~":!0,"!":!0,"*":!0,"(":!0,")":!0,"-":!0,_:!0,".":!0,",":!0,":":!0,"@":!0,$:!0,"'":!0,"/":!0},function(){for(var e=[],t=0;t<16;t++)for(var r=0;r<16;r++)if(t+r!=0){var n=String.fromCharCode(16*t+r);/\w|[-_.\/~]/.test(n)||e.push("\\u00"+t.toString(16)+r.toString(16))}i.not_idchar=e.join("")}(),i.not_idchar=" '!:(),*@$",i.not_idstart="-0123456789",e="[^"+i.not_idstart+i.not_idchar+"][^"+i.not_idchar+"]*",i.id_ok=new RegExp("^"+e+"$"),i.next_id=new RegExp(e,"g"),i.quote=function(e){return/^[-A-Za-z0-9~!*()_.',:@$\/]*$/.test(e)?e:encodeURIComponent(e).replace("%2C",",","g").replace("%3A",":","g").replace("%40","@","g").replace("%24","$","g").replace("%2F","/","g").replace("%20","+","g")},function(){var e={"'":!0,"!":!0},t={array:function(r){var o,s,a,u,n=["!("],f=r.length;for(a=0;a<f;a+=1)(s=t[typeof(u=r[a])])&&"string"==typeof(u=s(u))&&(o&&(n[n.length]=","),n[n.length]=u,o=!0);return n[n.length]=")",n.join("")},boolean:function(r){return r?"!t":"!f"},null:function(r){return"!n"},number:function(r){return isFinite(r)?String(r).replace(/\+/,""):"!n"},object:function(r){if(r){if(r instanceof Array)return t.array(r);if("object"==typeof r.__prototype__&&typeof r.__prototype__.encode_rison<"u")return r.encode_rison();var o,s,a,f,u,n=["("],d=[];for(a in r)d[d.length]=a;for(d.sort(),u=0;u<d.length;u++)(s=t[typeof(f=r[a=d[u]])])&&"string"==typeof(f=s(f))&&(o&&(n[n.length]=","),n.push(t.string(a),":",f),o=!0);return n[n.length]=")",n.join("")}return"!n"},string:function(r){return""==r?"''":i.id_ok.test(r)?r:"'"+(r=r.replace(/(['!])/g,function(n,o){return e[o]?"!"+o:o}))+"'"},undefined:function(r){throw new Error("rison can't encode the undefined value")}};i.encode=function(r){return t[typeof r](r)},i.encode_object=function(r){if("object"!=typeof r||null===r||r instanceof Array)throw new Error("rison.encode_object expects an object argument");var n=t[typeof r](r);return n.substring(1,n.length-1)},i.encode_array=function(r){if(!(r instanceof Array))throw new Error("rison.encode_array expects an array argument");var n=t[typeof r](r);return n.substring(2,n.length-1)},i.encode_uri=function(r){return i.quote(t[typeof r](r))}}(),i.decode=function(e){return new i.parser(function(n){throw Error("rison decoder error: "+n)}).parse(e)},i.decode_object=function(e){return i.decode("("+e+")")},i.decode_array=function(e){return i.decode("!("+e+")")},i.parser=function(e){this.errorHandler=e},i.parser.WHITESPACE="",i.parser.prototype.setOptions=function(e){e.errorHandler&&(this.errorHandler=e.errorHandler)},i.parser.prototype.parse=function(e){this.string=e,this.index=0,this.message=null;var t=this.readValue();return!this.message&&this.next()&&(t=this.error("unable to parse string as rison: '"+i.encode(e)+"'")),this.message&&this.errorHandler&&this.errorHandler(this.message,this.index),t},i.parser.prototype.error=function(e){typeof console<"u"&&console.log("rison parser error: ",e),this.message=e},i.parser.prototype.readValue=function(){var e=this.next(),t=e&&this.table[e];if(t)return t.apply(this);var r=this.string,n=this.index-1;i.next_id.lastIndex=n;var o=i.next_id.exec(r);if(o.length>0){var s=o[0];return this.index=n+s.length,s}return this.error(e?"invalid character: '"+e+"'":"empty expression")},i.parser.parse_array=function(e){for(var r,t=[];")"!=(r=e.next());){if(!r)return e.error("unmatched '!('");if(t.length)","!=r&&e.error("missing ','");else{if(","==r)return e.error("extra ','");--e.index}var n=e.readValue();if(typeof n>"u")return;t.push(n)}return t},i.parser.bangs={t:!0,f:!1,n:null,"(":i.parser.parse_array},i.parser.prototype.table={"!":function(){var t=this.string.charAt(this.index++);if(!t)return this.error('"!" at end of input');var r=i.parser.bangs[t];return"function"==typeof r?r.call(null,this):typeof r>"u"?this.error('unknown literal: "!'+t+'"'):r},"(":function(){for(var t,e={},r=0;")"!=(t=this.next());){if(r)","!=t&&this.error("missing ','");else{if(","==t)return this.error("extra ','");--this.index}var n=this.readValue();if(typeof n>"u")return;if(":"!=this.next())return this.error("missing ':'");var o=this.readValue();if(typeof o>"u")return;e[n]=o,r++}return e},"'":function(){for(var o,e=this.string,t=this.index,r=t,n=[];"'"!=(o=e.charAt(t++));){if(!o)return this.error('unmatched "\'"');if("!"==o){if(r<t-1&&n.push(e.slice(r,t-1)),o=e.charAt(t++),!("!'".indexOf(o)>=0))return this.error('invalid string escape: "!'+o+'"');n.push(o),r=t}}return r<t-1&&n.push(e.slice(r,t-1)),this.index=t,1==n.length?n[0]:n.join("")},"-":function(){var e=this.string,t=this.index,r=t-1,n="int",o="-",s={"int+.":"frac","int+e":"exp","frac+e":"exp"};do{var a=e.charAt(t++);if(!a)break;if(!("0"<=a&&a<="9")){if(o.indexOf(a)>=0){o="";continue}"exp"==(n=s[n+"+"+a.toLowerCase()])&&(o="-")}}while(n);return this.index=--t,"-"==(e=e.slice(r,t))?this.error("invalid number"):Number(e)}},function(e){for(var t=0;t<=9;t++)e[String(t)]=e["-"]}(i.parser.prototype.table),i.parser.prototype.next=function(){var e=this.string,t=this.index;do{if(t==e.length)return;var r=e.charAt(t++)}while(i.parser.WHITESPACE.indexOf(r)>=0);return this.index=t,r}});