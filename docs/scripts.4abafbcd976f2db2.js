!function(h,t){"function"==typeof define&&define.amd?define(["exports"],t):t("object"==typeof exports?exports:h.rison={})}(this,function(h){var e,t=h;typeof t>"u"&&(window.rison={}),t.uri_ok={"~":!0,"!":!0,"*":!0,"(":!0,")":!0,"-":!0,_:!0,".":!0,",":!0,":":!0,"@":!0,$:!0,"'":!0,"/":!0},function(){for(var e=[],n=0;n<16;n++)for(var i=0;i<16;i++)if(n+i!==0){var r=String.fromCharCode(16*n+i);/\w|[-_.\/~]/.test(r)||e.push("\\u00"+n.toString(16)+i.toString(16))}t.not_idchar=e.join("")}(),t.not_idchar=" '!:(),*@$",t.not_idstart="-0123456789",e="[^"+t.not_idstart+t.not_idchar+"][^"+t.not_idchar+"]*",t.id_ok=new RegExp("^"+e+"$"),t.next_id=new RegExp(e,"g"),t.quote=function(e){return/^[-A-Za-z0-9~!*()_.',:@$\/]*$/.test(e)?e:encodeURIComponent(e).replace(/%2C/g,",").replace(/%3A/g,":").replace(/%40/g,"@").replace(/%24/g,"$").replace(/%2F/g,"/").replace(/%20/g,"+")},function(){var e={"'":!0,"!":!0},n=function(r){r&&"function"==typeof r.toJSON&&(r=r.toJSON());var o=i[typeof r];if(o)return o(r)},i={array:function(r){var a,u,f,o=["!("],d=r.length;for(u=0;u<d;u+=1)"string"==typeof(f=n(r[u]))&&(a&&(o[o.length]=","),o[o.length]=f,a=!0);return o[o.length]=")",o.join("")},boolean:function(r){return r?"!t":"!f"},null:function(){return"!n"},number:function(r){return isFinite(r)?String(r).replace(/\+/,""):"!n"},object:function(r){if(r){if(r instanceof Array)return i.array(r);if("object"==typeof r.__prototype__&&typeof r.__prototype__.encode_rison<"u")return r.encode_rison();var a,s,u,d,f,o=["("],c=[];for(s in r)c[c.length]=s;for(c.sort(),f=0;f<c.length;f++)"string"==typeof(u=n(r[s=c[f]]))&&(a&&(o[o.length]=","),d=isNaN(parseInt(s))?i.string(s):i.number(s),o.push(d,":",u),a=!0);return o[o.length]=")",o.join("")}return"!n"},string:function(r){return""===r?"''":t.id_ok.test(r)?r:"'"+(r=r.replace(/(['!])/g,function(o,a){return e[a]?"!"+a:a}))+"'"},undefined:function(){}};t.encode=function(r){return n(r)},t.encode_object=function(r){if("object"!=typeof r||null===r||r instanceof Array)throw new Error("rison.encode_object expects an object argument");var o=i[typeof r](r);return o.substring(1,o.length-1)},t.encode_array=function(r){if(!(r instanceof Array))throw new Error("rison.encode_array expects an array argument");var o=i[typeof r](r);return o.substring(2,o.length-1)},t.encode_uri=function(r){return t.quote(i[typeof r](r))}}(),t.decode=function(e){return new t.parser(function(r){throw Error("rison decoder error: "+r)}).parse(e)},t.decode_object=function(e){return t.decode("("+e+")")},t.decode_array=function(e){return t.decode("!("+e+")")},t.parser=function(e){this.errorHandler=e},t.parser.WHITESPACE="",t.parser.prototype.setOptions=function(e){e.errorHandler&&(this.errorHandler=e.errorHandler)},t.parser.prototype.parse=function(e){this.string=e,this.index=0,this.message=null;var n=this.readValue();return!this.message&&this.next()&&(n=this.error("unable to parse string as rison: '"+t.encode(e)+"'")),this.message&&this.errorHandler&&this.errorHandler(this.message,this.index),n},t.parser.prototype.error=function(e){typeof console<"u"&&console.log("rison parser error: ",e),this.message=e},t.parser.prototype.readValue=function(){var e=this.next(),n=e&&this.table[e];if(n)return n.apply(this);var i=this.string,r=this.index-1;t.next_id.lastIndex=r;var o=t.next_id.exec(i);if(o.length>0){var a=o[0];return this.index=r+a.length,a}return this.error(e?"invalid character: '"+e+"'":"empty expression")},t.parser.parse_array=function(e){for(var i,n=[];")"!==(i=e.next());){if(!i)return e.error("unmatched '!('");if(n.length)","!==i&&e.error("missing ','");else{if(","===i)return e.error("extra ','");--e.index}var r=e.readValue();if(typeof r>"u")return;n.push(r)}return n},t.parser.bangs={t:!0,f:!1,n:null,"(":t.parser.parse_array},t.parser.prototype.table={"!":function(){var n=this.string.charAt(this.index++);if(!n)return this.error('"!" at end of input');var i=t.parser.bangs[n];return"function"==typeof i?i.call(null,this):typeof i>"u"?this.error('unknown literal: "!'+n+'"'):i},"(":function(){for(var n,e={},i=0;")"!==(n=this.next());){if(i)","!==n&&this.error("missing ','");else{if(","===n)return this.error("extra ','");--this.index}var r=this.readValue();if(typeof r>"u")return;if(":"!==this.next())return this.error("missing ':'");var o=this.readValue();if(typeof o>"u")return;e[r]=o,i++}return e},"'":function(){for(var o,e=this.string,n=this.index,i=n,r=[];"'"!==(o=e.charAt(n++));){if(!o)return this.error('unmatched "\'"');if("!"===o){if(i<n-1&&r.push(e.slice(i,n-1)),o=e.charAt(n++),!("!'".indexOf(o)>=0))return this.error('invalid string escape: "!'+o+'"');r.push(o),i=n}}return i<n-1&&r.push(e.slice(i,n-1)),this.index=n,1===r.length?r[0]:r.join("")},"-":function(){var e=this.string,n=this.index,i=n-1,r="int",o="-",a={"int+.":"frac","int+e":"exp","frac+e":"exp"};do{var s=e.charAt(n++);if(!s)break;if(!("0"<=s&&s<="9")){if(o.indexOf(s)>=0){o="";continue}"exp"===(r=a[r+"+"+s.toLowerCase()])&&(o="-")}}while(r);return this.index=--n,"-"===(e=e.slice(i,n))?this.error("invalid number"):Number(e)}},function(e){for(var n=0;n<=9;n++)e[String(n)]=e["-"]}(t.parser.prototype.table),t.parser.prototype.next=function(){var e,n=this.string,i=this.index;do{if(i===n.length)return;e=n.charAt(i++)}while(t.parser.WHITESPACE.indexOf(e)>=0);return this.index=i,e}});