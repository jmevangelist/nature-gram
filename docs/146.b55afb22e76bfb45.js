"use strict";(self.webpackChunknature_gram=self.webpackChunknature_gram||[]).push([[146],{1146:(L,d,i)=>{i.r(d),i.d(d,{CommentsComponent:()=>T});var t=i(9468),s=i(6814),g=i(3315),p=i(5429),c=i(7748),x=i(4893);const C=["check",(0,i(9482).h)({outline:'<path d="M13.72,27.69,3.29,17.27a1,1,0,0,1,1.41-1.41l9,9L31.29,7.29a1,1,0,0,1,1.41,1.41Z"/>'})];var _=i(945),l=i(95),f=i(2616),v=i(3893);function b(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"button",16,17),t.NdJ("click",function(){t.CHM(n);const r=t.MAs(1),m=t.oxw(2).$implicit,A=t.oxw();return t.KtG(A.agree(m.taxon,r))}),t._UZ(2,"cds-icon",18),t._uU(3,"agree"),t.qZA()}if(2&e){const n=t.oxw(3);t.Q6J("disabled",n.authServ.isExpired)("clrLoading",n.identBtnState)}}function M(e,a){if(1&e&&(t.ynx(0),t._UZ(1,"app-taxon",14),t.YNc(2,b,4,2,"button",15),t.BQk()),2&e){const n=t.oxw().$implicit;t.xp6(1),t.Q6J("taxon",n.taxon),t.xp6(1),t.Q6J("ngIf","supporting"!=n.category)}}const u=function(e){return["naturalist",e]};function O(e,a){if(1&e&&(t.TgZ(0,"div")(1,"div",3)(2,"div",4)(3,"a",5),t._UZ(4,"img",6),t.qZA()(),t.TgZ(5,"div",7)(6,"div",8)(7,"p",9)(8,"a",10),t._uU(9),t.qZA(),t._uU(10," \u30fb "),t.TgZ(11,"span",11),t._uU(12),t.ALo(13,"async"),t.ALo(14,"dateTimeAgo"),t.qZA(),t._uU(15," \u30fb "),t.TgZ(16,"span",11),t._uU(17),t.qZA()(),t.YNc(18,M,3,2,"ng-container",12),t._UZ(19,"p",13),t.qZA()()()()),2&e){const n=a.$implicit;t.xp6(3),t.Q6J("routerLink",t.VKq(13,u,n.user.login)),t.xp6(1),t.Q6J("src",n.user.icon||"assets/default.png",t.LSH),t.xp6(4),t.Q6J("routerLink",t.VKq(15,u,n.user.login)),t.xp6(1),t.Oqu(n.user.login),t.xp6(3),t.Oqu(t.lcZ(13,8,t.xi3(14,10,n.created_at,"short"))),t.xp6(5),t.Oqu(n.category),t.xp6(1),t.Q6J("ngIf",n.taxon),t.xp6(1),t.Q6J("innerHTML",n.body,t.oJD)}}const Z=function(e){return{"height.px":e}};function y(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"div",19)(1,"div",20),t._UZ(2,"img",6),t.qZA(),t.TgZ(3,"div",7)(4,"textarea",21,22),t.NdJ("ngModelChange",function(r){t.CHM(n);const m=t.oxw();return t.KtG(m.newComment=r)}),t._uU(6,"        "),t.qZA()(),t.TgZ(7,"div",4)(8,"button",23),t.NdJ("click",function(){t.CHM(n);const r=t.oxw();return t.KtG(r.onSubmit())}),t._uU(9,"Add"),t.qZA()()()}if(2&e){const n=t.MAs(5),o=t.oxw();t.xp6(2),t.Q6J("src",(null==o.authServ.me?null:o.authServ.me.icon)||"assets/default.png",t.LSH),t.xp6(2),t.Q6J("ngStyle",t.VKq(5,Z,n.scrollHeight))("ngModel",o.newComment),t.xp6(4),t.Q6J("clrLoading",o.submitBtnState)("disabled",!o.newComment)}}let T=(()=>{class e{constructor(){this.authServ=(0,t.f3M)(_.Z),this.inatServ=(0,t.f3M)(f.E),this.newComment="",this.submitBtnState=c.xp5.DEFAULT,this.identBtnState=c.xp5.DEFAULT}ngOnInit(){this.combination=this.comments.concat(...this.identifications).sort((n,o)=>Date.parse(n.created_at)-Date.parse(o.created_at))}agree(n,o){o.loadingStateChange(c.xp5.LOADING),this.inatServ.identification({identification:{taxon_id:n.id,observation_id:this.uuid}}).then(m=>{this.combination.push(...m)}).finally(()=>{o.loadingStateChange(c.xp5.DEFAULT)})}onSubmit(){this.newComment&&(this.submitBtnState=c.xp5.LOADING,this.inatServ.comment({fields:"string",comment:{parent_type:"Observation",parent_id:this.uuid,body:this.newComment}}).then(o=>{this.combination.push(...o)}).finally(()=>{this.newComment="",this.submitBtnState=c.xp5.DEFAULT}))}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-comments"]],inputs:{comments:"comments",identifications:"identifications",uuid:"uuid"},standalone:!0,features:[t.jDz],decls:3,vars:2,consts:[[1,"activity-container"],[4,"ngFor","ngForOf"],["class","clr-row your-input clr-align-items-center",4,"ngIf"],[1,"clr-row"],[1,"clr-col-auto"],[3,"routerLink"],[1,"user_icon",3,"src"],[1,"clr-col"],[1,"card-text"],[1,"user-name"],[1,"p4",3,"routerLink"],[1,"p7"],[4,"ngIf"],[1,"p5",3,"innerHTML"],[3,"taxon"],["class","btn btn-sm btn-success-outline btn-icon",3,"disabled","clrLoading","click",4,"ngIf"],[1,"btn","btn-sm","btn-success-outline","btn-icon",3,"disabled","clrLoading","click"],["b",""],["shape","check"],[1,"clr-row","your-input","clr-align-items-center"],[1,"clr-col-auto","user-icon-container"],["type","text","name","newcomment","rows","1","placeholder","comment",1,"p5",3,"ngStyle","ngModel","ngModelChange"],["textarea",""],[1,"btn","btn-link","btn-sm","comment-btn",3,"clrLoading","disabled","click"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0),t.YNc(1,O,20,17,"div",1),t.qZA(),t.YNc(2,y,10,7,"div",2)),2&n&&(t.xp6(1),t.Q6J("ngForOf",o.combination),t.xp6(1),t.Q6J("ngIf",!o.authServ.isExpired))},dependencies:[s.ez,s.sg,s.O5,s.PC,s.Ov,g.rH,p.i,c.K6A,c.nkF,c.cCV,c.MPb,l.u5,l.Fj,l.JJ,l.On,v.F],styles:[".user_icon[_ngcontent-%COMP%]{height:1rem;width:1rem;border-radius:50%}.user-icon-container[_ngcontent-%COMP%]{align-self:flex-start}p[_ngcontent-%COMP%]{margin-top:0!important}.taxon-common[_ngcontent-%COMP%]{line-height:.8rem!important}.taxon-container[_ngcontent-%COMP%]{display:flex;margin:.3rem 0}.card-text[_ngcontent-%COMP%] > .p5[_ngcontent-%COMP%]{line-height:.8rem!important}.taxon-img[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem;align-self:center}.taxon-taxon[_ngcontent-%COMP%]{margin-left:.3rem!important}.taxon-name[_ngcontent-%COMP%]{margin-top:0!important}.clr-row[_ngcontent-%COMP%]{margin:.3rem 0!important}.clr-col-auto[_ngcontent-%COMP%]{padding:0}a[_ngcontent-%COMP%]{text-decoration:unset}textarea[_ngcontent-%COMP%]{border-radius:.2rem;border-style:hidden;background-color:#e8e8e8;margin-top:0!important;width:100%}.your-input[_ngcontent-%COMP%]{margin-top:1rem}.comment-btn[_ngcontent-%COMP%]{padding:0!important;min-width:0}.activity-container[_ngcontent-%COMP%]{display:flex;overflow-y:scroll;flex-direction:column;max-height:65dvh;width:100%}"]}),e})();x.Q.addIcons(C)}}]);